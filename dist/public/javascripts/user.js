define("public",[],function(require,exports,module){var t={init:function(){t.bind(),t.selectDiv()},selectDiv:function(){$("body").on("click",".select span",function(t){var i=$(this).parents(".select"),e=$(i).children("ul");$(i).css({"border-color":"#b4dbed","box-shadow":"0px 0px 3px #c4e6f5"}),$(e).is(":hidden")?$(e).show():$(e).hide(),t.stopPropagation()}),$("body").on("click",".select ul li",function(t){var i=$(this).parents(".select"),e=$(this).text(),n=$(this).attr("t-type"),o=$(this).attr("t-id");$(i).children("span").html(e+"<i></i>").attr("t-type",n).attr("t-id",o),$(i).children("ul").hide(),t.stopPropagation()}),$("body").on("click",function(t){$(".select").length>0&&($(".select ul").hide(),$(".select").css({"border-color":"#d7d7d7","box-shadow":"inset 0px 1px 1px rgba(0, 0, 0, 0.06)"})),t.stopPropagation()})},bind:function(){$(".exit").on("click",function(){location.href="/login"})}};module.exports=t});
define("user",["public","pagination","echarts"],function(require,exports,module){var t=require("public");require("pagination");require("echarts");var e={init:function(){e.getMachineMenu(),e.bind(),t.init(),e.nav()},bind:function(){$(".status-btn").on("click",e.statusSwitch),$("body").on("click",".up-tool",e.upTool),$("body").on("click",".down",e.downTool)},nav:function(){$("body").on("click",".container-nav-btn li",function(){if(!$(this).hasClass("is-error")){$(".container-nav-btn li,.container-charts-btn li").removeClass("active"),$(this).addClass("active");var t=$(this).attr("m-id");$(".container").attr("m-id",t).show(),$(".welcome").hide(),e.getToolList({MachineId:t})}}),$("body").on("click",".container-charts-btn li",function(){$(".container-nav-btn li,.container-charts-btn li").removeClass("active"),$(this).addClass("active"),$(".welcome").hide(),$(".container").hide(),$(".charts").show(),"bar"==$(this).attr("e-type")?e.eachrtsBar():e.eachrtsLine()})},statusSwitch:function(){var t=$(this).children("i"),a=$(".container").attr("m-id");"left"==$(t).attr("is")?($(t).css("left","30px").attr("is","right"),$(".container-table").eq(0).hide(),$(".container-table").eq(1).show(),$(".up-tool").hide(),e.getToolListDown({MachineId:a})):($(t).css("left","0px").attr("is","left"),$(".container-table").eq(0).show(),$(".container-table").eq(1).hide(),$(".up-tool").show(),e.getToolList({MachineId:a}))},echartsFn:function(t){var e=echarts.init(document.getElementById(t.obj));option={tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},xAxis:[{type:"category",data:t.x_data,axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:t.y_name,min:0,max:100,interval:10,axisLabel:{formatter:"{value} %"}}],series:[{name:t.y_name,type:t.type,data:t.y_data}]},e.setOption(option)},eachrtsBar:function(){$.ajax({type:"post",url:"/api/machine/get",data:{PageIndex:1,PageSize:1e4},beforeSend:function(){$(".charts-loading").show()},success:function(t){if($(".charts-loading").hide(),t.status){t.message&&t.message;swal("失败!","获取柱形图失败!","error")}else e.echartsFn({obj:"echarts-main",x_data:["1","2","3"],y_name:"平均使用效率",y_data:["10","20","30"],type:"bar"})},error:function(t){$(".charts-loading").hide(),swal("失败!","获取柱形图失败!错误："+t.status,"error"),e.echartsFn({obj:"echarts-main",x_data:["1","2","3"],y_name:"平均使用效率",y_data:["10","20","30"],type:"bar"})}})},eachrtsLine:function(){$.ajax({type:"post",url:"/api/machine/get",data:{PageIndex:1,PageSize:1e4},beforeSend:function(){$(".charts-loading").show()},success:function(t){if($(".charts-loading").hide(),t.status){t.message&&t.message;swal("失败!","获取折线图失败!","error")}else e.echartsFn({obj:"echarts-main",x_data:["1","2","3"],y_name:"平均2使用效率",y_data:["10","20","30"],type:"line"})},error:function(t){$(".charts-loading").hide(),swal("失败!","获取折线图失败!错误："+t.status,"error"),e.echartsFn({obj:"echarts-main",x_data:["1","2","3"],y_name:"平均使用效率",y_data:["10","20","30"],type:"line"})}})},upTool:function(){var t=$(".container").attr("m-id");swal({title:"刀具上新",text:'<div class="add-machine-body"><div class="select"><span>正在获取刀具列表...<i></i></span><ul></ul></div><input type="text" placeholder="预计寿命/天" class="life" style="display: block" /><p class="error-msg"></p></div>',html:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"添加",closeOnConfirm:!1,cancelButtonText:"取消"},function(){var a=$(".add-machine-body .select span").attr("t-type"),n=$(".container").attr("m-id"),i=$(".add-machine-body .select span").text(),o=$(".add-machine-body .life").val(),s=$(".add-machine-body .select span").attr("t-id");return a&&i?o?isNaN(o)||o<=0?($(".error-msg").text("预计寿命请填写正确的数值！").fadeIn(),!1):void $.ajax({type:"post",url:"/api/record/add",async:!0,data:{ToolId:s,ToolType:a,MachineId:n,ToolName:i,LifeExpectancy:o},success:function(a){if(a.status){var n=a.message?a.message:"刀具上新失败!";swal("失败!",n,"error")}else swal("成功!","刀具上新成功！","success"),e.getToolList({MachineId:t})},error:function(t){swal("失败!","刀具上新失败!错误："+t.status,"error")}}):($(".error-msg").text("请填写刀具预计寿命！").fadeIn(),!1):($(".error-msg").text("请选择刀具！").fadeIn(),!1)}),$.ajax({type:"post",url:"/api/tool/get",async:!0,data:{PageIndex:1,PageSize:1e3},success:function(t){var e,a,n,i=[];t.status?i.push("<li>刀具列表为空</li>"):$(t.data).each(function(t,o){0===t&&(e=o.ToolName,a=o.ToolType,n=o.Id),i.push('<li t-id="'+o.Id+'" t-type="'+o.ToolType+'">'+o.ToolName+"</li>")}),$(".add-machine-body .select span").text(e).attr("t-type",a).attr("t-id",n),$(".add-machine-body .select ul").html(i.join(""))},error:function(t){$(".add-machine-body .select span").text("获取失败!错误："+t.status)}})},downTool:function(){var t=$(".container").attr("m-id"),a=$(this).parents("tr").attr("t-id");swal({title:"刀具下架",text:'<div class="down-tool-body"><input type="text" placeholder="下架原因,默认：正常寿命结束" class="reason" style="display: block" /></div>',html:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确认",closeOnConfirm:!1,cancelButtonText:"取消"},function(){var n=$(".down-tool-body .reason").val();n||(n="正常寿命结束"),$.ajax({type:"post",url:"/api/record/delete",async:!0,data:{DeleteReason:n,Id:a},success:function(a){if(a.status){var n=a.message?a.message:"刀具下架失败!";swal("失败!",n,"error")}else swal("成功!","刀具下架成功！","success"),e.getToolList({MachineId:t})},error:function(t){swal("失败!","刀具下架失败!错误："+t.status,"error")}})})},getMachineMenu:function(){$.ajax({type:"post",url:"/api/machine/get",async:!0,data:{PageIndex:1,PageSize:1e4},success:function(t){var e=[];t.status?e.push('<li m-id="">没有机床</li>'):$(t.data).each(function(t,a){e.push('<li m-id="'+a.Id+'">'+a.MachineName+"</li>")}),$(".container-nav-btn").html(e.join(""))},error:function(t){$(".container-nav-btn").html('<li m-id="" class="is-error">获取失败，错误：'+t.status+"</li>")}})},getToolList:function(t){var e=$(".working table tbody"),a=$(".working .page"),n=t.MachineId;a.pagination({ajax:{on:!0,type:"post",url:"/api/record/get",dataType:"json",param:{MachineId:n,PageIndex:1,PageSize:10,IsView:1},ajaxStart:function(){$(".working .working-loading").show()},callback:function(t){$(".working .working-loading").hide();var a=[];if(t.status){var n=t.message?t.message:"获取刀具列表失败";a.push('<tr><td align="center">'+n+"</td></tr>")}else t.data.length>0?$(t.data).each(function(t,e){var n=e.AddTime.substring(e.AddTime.indexOf("."),e.AddTime.length),i='<tr t-id="'+e.Id+'"><td>'+e.Id+"</td><td>"+e.ToolName+"</td><td>"+e.ToolType+"</td><td>"+e.AddTime.replace("T"," ").replace(n,"")+"</td><td>"+e.WorkTime+"天</td><td>"+e.LifeExpectancy+"天</td><td>"+e.SurplusLife+'天</td><td align="center"><button class="delete down">换下</button></td></tr>';a.push(i)}):a.push('<tr><td align="center" colspan="8">没有数据</td></tr>');$(e).html(a.join(""))}}})},getToolListDown:function(t){var e=$(".damage table tbody"),a=$(".damage .page"),n=t.MachineId;a.pagination({ajax:{on:!0,type:"post",url:"/api/record/get",dataType:"json",param:{MachineId:n,PageIndex:1,PageSize:10,IsView:0},ajaxStart:function(){$(".damage .working-loading").show()},callback:function(t){$(".damage .working-loading").hide();var a=[];if(t.status){var n=t.message?t.message:"获取刀具列表失败";a.push('<tr><td align="center">'+n+"</td></tr>")}else t.data.length>0?$(t.data).each(function(t,e){var n=e.AddTime.substring(e.AddTime.indexOf("."),e.AddTime.length),i="<tr><td>"+e.ToolId+"</td><td>"+e.ToolName+"</td><td>"+e.ToolType+"</td><td>"+e.AddTime.replace("T"," ").replace(n,"")+"</td><td>"+e.WorkTime+"天</td><td>"+e.LifeExpectancy+"天</td><td>"+e.SurplusLife+"天</td><td>"+e.DeleteTime+"</td><td>"+e.DeleteReason+"</td></tr>";a.push(i)}):a.push('<tr><td align="center" colspan="9">没有数据</td></tr>');$(e).html(a.join(""))}}})}};module.exports=e.init()});